<html>
<head>
<title>Hashwords - Hash Passwords that anybody can create.</title>

<link rel="stylesheet" href="css/ui.tabs.css" type="text/css" media="print, projection, screen">

<script src="js/md4.js" type="text/javascript"></script>
<script src="js/md5.js" type="text/javascript"></script>
<script src="js/sha1.js" type="text/javascript"></script>
<script src="js/sha256.js" type="text/javascript"></script>
<script src="js/base64.js" type="text/javascript"></script>

        <script src="js/jquery-1.2.6.js" type="text/javascript"></script> 
        <script src="js/ui.core.js" type="text/javascript"></script> 
        <script src="js/ui.tabs.js" type="text/javascript"></script> 
        <script src="js/jquery.cookies.2.0.js" type="text/javascript"></script>
        
<script type="text/javascript">

  var STRONG = 'ABCDEFGHJKLMNPQRSTUVWabcdefghijkmnopqrstuvw0123456789+/-_*()[]{}'
  var WEAK =   'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'

  var TIME_UNTIL_EXPIRY = 24 * 7 ; // 7 days
  var DEFAULT_LENGTH = "12";
  var DEFAULT_HASH = "sha256";
  var DEFAULT_CHARSET = STRONG;
  
function generatePassword() {
  var password = "";
  var hashAlgorithm = $('#hash').val();
  var key = encrypt(hashAlgorithm, $('#master').val());
  var data = $('#url').val();
  
  var password = encrypt(hashAlgorithm, key + data);
  password = base64_encode(password, $('#charset').val());
  password = password.substring(0, $('#length').val());

  $('#hashword').val(password);
}

function encrypt(hashAlgorithm, data) {
  var encrypted_string;

  switch(hashAlgorithm) {
    case "sha1":
      encrypted_string = str_sha1(data);
      break;
    case "md4":
      encrypted_string = str_md4(data);
      break;
    case "md5":
      encrypted_string = hex_md5(data);
      break;
    case "sha256":
      encrypted_string = hex_sha256(data);
      break;
  }
  return encrypted_string;
}

function getDomain(url) {
  var current_URL = '';
  if (url.indexOf('?') > -1) {
  	current_URL = unescape(url.substr(url.indexOf('?')+1));
  }

  if (current_URL == 'localhost')
    return current_URL;
  if (IsIp(current_URL)) 
    return current_URL;
  if (current_URL == '')
    return current_URL;

  var split = current_URL.split('.'); //location.hostname.split('.');
  var domain = [split.pop()];
  var item;

  while (item = split.pop()) {
    domain.unshift(item);
    if (item.length > 2) {
      break;
    }
  }

  return domain.join('.');
}

function IsIp(ip) {
  var regexp = /^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/
  return regexp.test(ip);
}

function setCharset(charset) {
  $("charset").value = charset;
}

  $(document).ready(function(){
	  $('#url').val(getDomain(window.location.href)); 

    $("#example > ul").tabs();

    $('#master').cookieBind(); 
		$('#length').val($.cookies.get('length') || DEFAULT_LENGTH); 
		$('#hash').val($.cookies.get('hash') || DEFAULT_HASH);  
		$('#charset').val($.cookies.get('charset') || DEFAULT_CHARSET);
		
		$('#main .dynamic').bind('keydown keypress keyup change',function(){
			generatePassword();
		})
		$('#settings .dynamic').change(function(){
			generatePassword();
		})
		$("#settings a").click(function(e){
		  e.preventDefault();
			switch($(this).html()) {
		    case "Weak":
		      $('#charset').val(WEAK);
		      break;
		    case "Strong":
		      $('#charset').val(STRONG);
		      break;
		  }
		  generatePassword();
		});
		
		generatePassword();
		$('#master').focus();
  });
	
  $(window).unload(function(){
		$('#length').cookify({hoursToLive: TIME_UNTIL_EXPIRY});
		$('#hash').cookify({hoursToLive: TIME_UNTIL_EXPIRY});
		$('#charset').cookify({hoursToLive: TIME_UNTIL_EXPIRY});
	});
</script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-7482154-2");
pageTracker._trackPageview();
} catch(err) {}</script>
</head>
<body>

        <div id="example" class="flora">
            <ul>

                <li><a href="#main"><span>Main</span></a></li>
                <li><a href="#settings"><span>Settings</span></a></li>
                <li><a href="#bookmarklet"><span>Bookmarklet</span></a></li>
            </ul>
            <div id="main">
              <table cellpadding=5>
              <tr>
              <td>Master password</td>
              <td><input class="dynamic" type="password" id="master" />
              </td>
              </tr>
              <tr id='urlToUseRow'>
              <td>URL to use</td>
              <td><input class="dynamic" type="text" id="url" /></td>
              </tr>
              <tr>
              <td>Generated Hashword</td>
              <td><input id="hashword" type="text" style="color: #0000ff; font-weight: bold"/></td>
              </tr>
              </table>            
            </div>
            <div id="settings">
              <table cellpadding=5>
              <tr>
              <td>Hash Algorithm</td>
              <td>
              <select class="dynamic" id="hash" >
              <option value="md4">MD4</option>
              <option value="md5">MD5</option>
              <option value="sha1">SHA-1</option>
              <option value="sha256">SHA-256</option>
              </select>
              </td>
              </tr>
              <tr>
              <td>Hashword Length</td>
              <td><select class="dynamic" id="length">
              <option value="8">8</option>
              <option value="12">12</option>
              <option value="16">16</option>
              </select></td>
              </tr>
              <tr>
              <td>Characters</td>
              <td>
                <a href="#" onClick="setCharset(WEAK);return false;">AlphaNumeric</a> | 
                <a href="#" onClick="setCharset(STRONG);return false;">Strong</a></br/>
                <input class="dynamic" type="text" id="charset"/>
              </td></tr>
              </table>            
            </div>
						<div id="bookmarklet">
							<center>
							<p>Generate Hashwords the easy way!  Drag this bookmarklet to the Links area of your browser.</p>
							<p><a style="border: 2px groove black; padding: 0px 5px 2px; background-color: rgb(221, 221, 221); color: black; font-family: sans-serif; text-decoration: none; font-size: 10pt; margin-top: 5px;" href='javascript:(function(){var a=window,b=document,c=a.open("http://hashwords.sideline.ca?"+b.location.hostname,"hash_popup","left="+((a.screenX||a.screenLeft)+10)+",top="+((a.screenY||a.screenTop)+10)+",height=200px,width=400px,resizable=1,alwaysRaised=1");a.setTimeout(function(){c.focus()},300)})();'>Hash&nbsp;It!</a></p>			
							</center>				
						</div>
        </div>
</body>
</html>
